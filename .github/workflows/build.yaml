---

name: "Build ISO"
run-name: "Build ISO"
on: push

jobs:
  build:
    name: "Build ISO"
    runs-on: ubuntu-latest

    container:
      image: archlinux/archlinux:latest
      options: --privileged

    steps:

      - id: checkout
        name: "Checkout"
        uses: actions/checkout@v5

      - id: install-archiso
        name: "Install ArchISO"
        run: pacman --sync --refresh --sysupgrade --noconfirm --quiet archiso qemu-base

      - id: prepare-custom-profile
        name: "Prepare Custom Profile"
        run: cp --verbose --recursive /usr/share/archiso/configs/releng/ archlive/

      - id: make-iso
        name: "Make ISO"
        run: mkarchiso -v -r archlive

      - id: run-iso
        name: "Run ISO"
        run: run_archiso -i /path/to/archlinux-yyyy.mm.dd-x86_64.iso

      - id: upload-artifact
        name: "Upload ISO Artifact"
        uses: actions/upload-artifact@v5
        with:
          name: Custom Arch Linux ISO
          path: out/archlinux-*.iso

          # The desired behavior if no files are found using the provided path.
          #
          # Available Options:
          #   warn: Output a warning but do not fail the action
          #   error: Fail the action with an error message
          #   ignore: Do not output any warnings or errors, the action does not fail
          if-no-files-found: error

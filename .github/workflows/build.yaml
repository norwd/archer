---

name: "Build ISO"
run-name: "Build ISO"
on: push

jobs:
  build:
    name: "Build ISO"
    runs-on: ubuntu-latest

    container:
      image: archlinux/archlinux:latest
      options: --privileged

    steps:

      - id: checkout
        name: "Checkout"
        uses: actions/checkout@v5

      - id: install-archiso
        name: "Install ArchISO"
        run: pacman --sync --refresh --sysupgrade --noconfirm --quiet archiso

      - id: prepare-custom-profile
        name: "Prepare Custom Profile"
        run: cp --recursive /usr/share/archiso/configs/releng/ archlive

      - id: prepare-install-script
        name: "Prepare Install Script"
        run: |
          curl --silent --show-error --location --remote-name --output-dir archlive/airootfs/root/ https://github.com/archlinux/archinstall/raw/refs/heads/master/examples/full_automated_installation.py

          tee --append archlive/airootfs/root/.zshrc << EOF
          archinstall --script full_automated_installation
          EOF

      - id: make-iso
        name: "Make ISO"
        run: mkarchiso -v -r archlive

      - id: upload-artifact
        name: Upload ISO Artifact
        uses: actions/upload-artifact@v5
        with:
          name: Custom Arch Linux ISO
          path: out/archlinux-*.iso

          # The desired behavior if no files are found using the provided path.
          #
          # Available Options:
          #   warn: Output a warning but do not fail the action
          #   error: Fail the action with an error message
          #   ignore: Do not output any warnings or errors, the action does not fail
          if-no-files-found: error
